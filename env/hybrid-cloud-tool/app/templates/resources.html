<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resources</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            color: #333;
        }

        select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }

        iframe {
            width: 100%;
            height: 400px;
            border: none;
            margin-bottom: 20px;
        }

        #grafana-container h2 {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Azure Resources</h1>
    <select id="azure-resources-dropdown">
        <option value="">Select an Azure resource</option>
    </select>

    <h1>AWS Resources</h1>
    <select id="aws-resources-dropdown">
        <option value="">Select an AWS resource</option>
    </select>
    
    <div id="grafana-container"></div>

    <script>
        // Function to fetch and display Azure resources
        fetch('/azure_resources')
            .then(response => response.json())
            .then(data => {
                const dropdown = document.getElementById('azure-resources-dropdown');
                data.forEach(resource => {
                    const option = document.createElement('option');
                    option.value = resource.id;
                    option.textContent = `${resource.name} (${resource.type})`;
                    dropdown.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching Azure resources:', error));

        // Function to fetch and display AWS resources
        fetch('/aws_resources')
            .then(response => response.json())
            .then(data => {
                const dropdown = document.getElementById('aws-resources-dropdown');
                Object.keys(data).forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    dropdown.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching AWS resources:', error));

        // Function to show Grafana dashboards for all resources of a given name
        function showGrafanaDashboards(type, resources) {
            const grafanaContainer = document.getElementById('grafana-container');
            grafanaContainer.innerHTML = '';

            resources.forEach(resource => {
                let srcUrl = '';
                if (type === 'azure') {
                    // Ensure you have correct panelId and URL for Azure resources
                    srcUrl = `http://localhost:3000/d-solo/ddsc6vkc9ik8wc/resume-dashboard-hybrid?orgId=1&panelId=1`;
                } else if (type === 'aws') {
                    srcUrl = `http://localhost:3000/d-solo/tmsOtSxZk/amazon-ec2?orgId=1&panelId=${resource.id}`;
                }

                const iframe = document.createElement('iframe');
                iframe.src = srcUrl;

                const title = document.createElement('h2');
                title.textContent = resource.type;

                grafanaContainer.appendChild(title);
                grafanaContainer.appendChild(iframe);
            });
        }

        // Event listeners for dropdown selections
        document.getElementById('azure-resources-dropdown').addEventListener('change', (event) => {
            const selectedOption = event.target.options[event.target.selectedIndex];
            if (selectedOption.value) {
                // Fetch additional data if needed
                fetch('/azure_resources')
                    .then(response => response.json())
                    .then(data => {
                        const selectedResource = data.find(resource => resource.id === selectedOption.value);
                        showGrafanaDashboards('azure', [selectedResource]);
                    })
                    .catch(error => console.error('Error fetching Azure resources:', error));
            }
        });

        document.getElementById('aws-resources-dropdown').addEventListener('change', (event) => {
            const selectedName = event.target.value;
            if (selectedName) {
                fetch('/aws_resources')
                    .then(response => response.json())
                    .then(data => {
                        showGrafanaDashboards('aws', data[selectedName]);
                    })
                    .catch(error => console.error('Error fetching AWS resources:', error));
            }
        });
    </script>
</body>
</html>
